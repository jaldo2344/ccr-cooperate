<!DOCTYPE html>
<html lang="pt-BR" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CCR - Plataforma Futurista de Pagamentos e BaaS</title>
    
    <!-- Favicon SVG -->
    <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Cdefs%3E%3ClinearGradient id='g' x1='0' y1='0' x2='1' y2='1'%3E%3Cstop offset='0%25' stop-color='%2338bdf8'/%3E%3Cstop offset='100%25' stop-color='%23a78bfa'/%3E%3C/linearGradient%3E%3C/defs%3E%3Crect width='100' height='100' rx='20' fill='%23020617'/%3E%3Cpath d='M62,25 C70.83,25 78,32.17 78,41 L78,59 C78,67.83 70.83,75 62,75 L50,75 L50,65 L62,65 C65.31,65 68,62.31 68,59 L68,41 C68,37.69 65.31,35 62,35 L38,35 C34.69,35 32,37.69 32,41 L32,45 L22,45 L22,41 C22,32.17 29.17,25 38,25 Z' fill='url(%23g)'/%3E%3C/svg%3E">

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Google Fonts: Inter (geral) e Orbitron (logo) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Orbitron:wght@800&display=swap" rel="stylesheet">

    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #020617; /* bg-slate-950 */
            color: #e2e8f0; /* text-slate-200 */
        }
        .font-orbitron { font-family: 'Orbitron', sans-serif; }
        .aurora-bg {
            position: absolute; top: 50%; left: 50%;
            transform: translate(-50%, -50%); width: 80vw; height: 80vh;
            background: linear-gradient(45deg, rgba(56, 189, 248, 0.15), rgba(167, 139, 250, 0.2));
            filter: blur(100px); border-radius: 50%; z-index: 0; pointer-events: none;
        }
        .modal-tab.active { background-color: #1e293b; color: #f8fafc; }
        .validation-item.valid { color: #22c55e; }
        .validation-item.invalid { color: #94a3b8; }
        .action-btn:disabled { background: #334155; cursor: not-allowed; transform: none; }
        .action-btn:disabled:hover { background: #334155; }
        .modal-backdrop { transition: opacity 0.3s ease; }
        .modal-content { transition: transform 0.4s cubic-bezier(0.25, 1, 0.5, 1), opacity 0.4s ease; }
        .step-container { display: flex; transition: transform 0.5s cubic-bezier(0.4, 0, 0.2, 1); }
        .step { min-width: 100%; transition: opacity 0.3s ease-in-out; }
    </style>
</head>
<body class="antialiased">

    <!-- Cabeçalho -->
    <header class="bg-slate-950/70 backdrop-blur-lg fixed top-0 left-0 right-0 z-40 border-b border-slate-800">
        <div class="container mx-auto px-6 py-4 flex justify-between items-center">
            <a href="#" class="flex items-center space-x-3">
                <svg width="36" height="36" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                    <defs><linearGradient id="logo-gradient" x1="0" y1="0" x2="1" y2="1"><stop offset="0%" stop-color="#38bdf8"/><stop offset="100%" stop-color="#a78bfa"/></linearGradient></defs>
                    <rect width="100" height="100" rx="20" fill="#0f172a"/>
                    <path d="M62,25 C70.83,25 78,32.17 78,41 L78,59 C78,67.83 70.83,75 62,75 L50,75 L50,65 L62,65 C65.31,65 68,62.31 68,59 L68,41 C68,37.69 65.31,35 62,35 L38,35 C34.69,35 32,37.69 32,41 L32,45 L22,45 L22,41 C22,32.17 29.17,25 38,25 Z" fill="url(#logo-gradient)"/>
                </svg>
                <span class="text-2xl font-orbitron font-extrabold text-white">CCR</span>
            </a>
            <nav class="hidden md:flex items-center space-x-6">
                <a href="#solucoes" class="text-slate-400 hover:text-white transition-colors duration-300">Soluções</a>
                <a href="#vantagens" class="text-slate-400 hover:text-white transition-colors duration-300">Vantagens</a>
                <a href="#contato" class="text-slate-400 hover:text-white transition-colors duration-300">Contato</a>
            </nav>
            <div class="flex items-center gap-4">
                <a href="/compras.html" target="_blank" class="text-slate-300 hover:text-white font-semibold transition-colors duration-300">Acessar Painel</a>
                <button id="open-signup-modal-btn" class="bg-slate-50 hover:bg-white text-slate-900 font-semibold px-5 py-2.5 rounded-lg shadow-md hover:shadow-sky-400/20 transition-all duration-300 transform hover:-translate-y-0.5">
                    Criar Conta
                </button>
            </div>
        </div>
    </header>

    <main class="relative">
        <section id="inicio" class="relative min-h-screen flex items-center justify-center text-center pt-20 overflow-hidden">
            <div class="aurora-bg"></div>
            <div class="container mx-auto px-6 z-10">
                <h1 class="text-4xl md:text-6xl font-extrabold text-white leading-tight mb-4">A Infraestrutura de Pagamentos<br> para a <span class="text-transparent bg-clip-text bg-gradient-to-r from-sky-400 to-violet-400">Próxima Geração</span>.</h1>
                <p class="text-lg md:text-xl text-slate-400 max-w-3xl mx-auto mb-8">Liquidação, BaaS e Gateway de Pagamentos em uma plataforma unificada. Construa o futuro da sua fintech com a tecnologia e segurança da CCR.</p>
                <div class="flex justify-center items-center gap-4">
                    <button id="open-signup-modal-btn-hero" class="bg-gradient-to-r from-sky-500 to-violet-500 hover:from-sky-400 hover:to-violet-400 text-white font-bold px-8 py-3 rounded-lg shadow-lg shadow-sky-500/20 transition-all duration-300 transform hover:scale-105">Comece Agora</button>
                </div>
            </div>
        </section>
        
        <!-- Seção Soluções -->
        <section id="solucoes" class="py-20 lg:py-28 relative z-10">
            <div class="container mx-auto px-6">
                <div class="text-center mb-16">
                    <span class="font-semibold tracking-wide text-transparent bg-clip-text bg-gradient-to-r from-sky-400 to-violet-400">NOSSAS SOLUÇÕES</span>
                    <h2 class="text-3xl md:text-4xl font-extrabold text-white mt-2">Tecnologia para Impulsionar sua Inovação</h2>
                    <p class="text-slate-400 mt-3 max-w-2xl mx-auto">APIs e plataformas flexíveis para cada necessidade do seu negócio.</p>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-2 gap-8 max-w-4xl mx-auto">
                    <div class="bg-slate-900/60 backdrop-blur-xl p-8 rounded-2xl transition-all duration-300 border border-slate-800 hover:border-sky-500/50 hover:bg-slate-800/60 hover:-translate-y-1">
                        <i data-lucide="building-2" class="w-12 h-12 text-sky-400 mb-5 p-3 bg-slate-800 rounded-lg"></i>
                        <h3 class="text-xl font-bold text-white mb-2">Banking as a Service</h3>
                        <p class="text-slate-400">Crie contas digitais, emita cartões e gerencie transações com nossa infraestrutura completa.</p>
                    </div>
                    <div class="bg-slate-900/60 backdrop-blur-xl p-8 rounded-2xl transition-all duration-300 border border-slate-800 hover:border-sky-500/50 hover:bg-slate-800/60 hover:-translate-y-1">
                        <i data-lucide="credit-card" class="w-12 h-12 text-sky-400 mb-5 p-3 bg-slate-800 rounded-lg"></i>
                        <h3 class="text-xl font-bold text-white mb-2">Gateway de Pagamentos</h3>
                        <p class="text-slate-400">Processe pagamentos online (PIX, Cartão, Boleto) com alta performance e conciliação automática.</p>
                    </div>
                    <div class="bg-slate-900/60 backdrop-blur-xl p-8 rounded-2xl transition-all duration-300 border border-slate-800 hover:border-sky-500/50 hover:bg-slate-800/60 hover:-translate-y-1">
                        <i data-lucide="swords" class="w-12 h-12 text-sky-400 mb-5 p-3 bg-slate-800 rounded-lg"></i>
                        <h3 class="text-xl font-bold text-white mb-2">Plataforma iGaming</h3>
                        <p class="text-slate-400">Depósitos e saques instantâneos com a segurança e velocidade que o mercado de iGaming exige.</p>
                    </div>
                    <div class="bg-slate-900/60 backdrop-blur-xl p-8 rounded-2xl transition-all duration-300 border border-slate-800 hover:border-sky-500/50 hover:bg-slate-800/60 hover:-translate-y-1">
                        <i data-lucide="arrow-right-left" class="w-12 h-12 text-sky-400 mb-5 p-3 bg-slate-800 rounded-lg"></i>
                        <h3 class="text-xl font-bold text-white mb-2">Mesa OTC e Cripto</h3>
                        <p class="text-slate-400">Receba pagamentos em PIX, cartões e criptomoedas como Bitcoin através de nossa mesa de operações, com liquidação rápida e segura.</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Seção Vantagens -->
        <section id="vantagens" class="py-20 lg:py-28 relative z-10">
            <div class="container mx-auto px-6">
                <div class="text-center mb-16">
                     <span class="font-semibold tracking-wide text-transparent bg-clip-text bg-gradient-to-r from-sky-400 to-violet-400">POR QUE A CCR?</span>
                    <h2 class="text-3xl md:text-4xl font-extrabold text-white mt-2">Uma parceria estratégica para o seu sucesso</h2>
                </div>
                <div class="max-w-4xl mx-auto grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-10">
                    <div class="text-center"><i data-lucide="gauge-circle" class="w-10 h-10 text-sky-400 mx-auto mb-3"></i><h4 class="font-bold text-white text-lg">Alta Performance</h4><p class="text-slate-400 text-sm">Infraestrutura com 99.9% de uptime, garantindo que sua operação nunca pare.</p></div>
                    <div class="text-center"><i data-lucide="shield-check" class="w-10 h-10 text-sky-400 mx-auto mb-3"></i><h4 class="font-bold text-white text-lg">Prevenção à Fraude</h4><p class="text-slate-400 text-sm">Motor antifraude com IA para proteger suas transações e seus clientes.</p></div>
                    <div class="text-center"><i data-lucide="layout-dashboard" class="w-10 h-10 text-sky-400 mx-auto mb-3"></i><h4 class="font-bold text-white text-lg">Dashboard Unificado</h4><p class="text-slate-400 text-sm">Visualize e gerencie toda a sua operação financeira em um único lugar.</p></div>
                    <div class="text-center"><i data-lucide="headphones" class="w-10 h-10 text-sky-400 mx-auto mb-3"></i><h4 class="font-bold text-white text-lg">Suporte Especializado</h4><p class="text-slate-400 text-sm">Conte com nosso time de especialistas em pagamentos 24/7.</p></div>
                </div>
            </div>
        </section>
        
        <!-- Seção Fale Conosco -->
        <section id="contato" class="py-20 lg:py-28 relative z-10">
            <div class="container mx-auto px-6">
                <div class="bg-slate-900/60 backdrop-blur-xl rounded-2xl p-8 md:p-16 border border-slate-800">
                    <div class="grid md:grid-cols-2 gap-12 items-center">
                        <div><h2 class="text-3xl font-extrabold text-white">Pronto para construir o futuro?</h2><p class="text-slate-400 mt-4">Deixe seus dados e um de nossos consultores entrará em contato para desenhar a solução ideal para seu negócio.</p></div>
                        <div class="bg-slate-900 p-8 rounded-xl border border-slate-700"><form action="#" method="POST" class="space-y-5"><div><label for="nome-contato" class="block text-sm font-medium text-slate-400">Nome Completo</label><input type="text" id="nome-contato" required class="mt-1 block w-full bg-slate-800 border-slate-600 text-white rounded-md shadow-sm focus:ring-sky-500 focus:border-sky-500"></div><div><label for="email-contato" class="block text-sm font-medium text-slate-400">E-mail corporativo</label><input type="email" id="email-contato" required class="mt-1 block w-full bg-slate-800 border-slate-600 text-white rounded-md shadow-sm focus:ring-sky-500 focus:border-sky-500"></div><div><button type="submit" class="w-full bg-gradient-to-r from-sky-500 to-violet-500 hover:from-sky-400 hover:to-violet-400 text-white font-semibold py-3 px-4 rounded-lg shadow-md transition-all duration-300">Solicitar Contato</button></div></form></div>
                    </div>
                </div>
            </div>
        </section>
    </main>
    
    <!-- Rodapé -->
    <footer class="border-t border-slate-800 relative z-10">
        <div class="container mx-auto px-6 py-8 text-center text-slate-500">
            <p>&copy; 2024 CCR Soluções de Pagamento e Liquidação LTDA. Todos os direitos reservados.</p>
            <p class="mt-2 text-sm">CNPJ: 08.482.873/0001-90</p>
            <div class="mt-4 flex justify-center items-center">
                <a href="https://wa.me/556696351808" target="_blank" rel="noopener noreferrer" class="flex items-center gap-2 text-slate-400 hover:text-white transition-colors">
                    <i data-lucide="message-square" class="w-4 h-4"></i>
                    <span>Fale Conosco via WhatsApp</span>
                </a>
            </div>
        </div>
    </footer>
    
    <!-- MODAL DE CADASTRO (SIGN UP) -->
    <div id="signup-modal" class="fixed inset-0 bg-black/80 backdrop-blur-sm z-50 flex items-center justify-center p-4 hidden modal-backdrop">
        <div id="signup-modal-content" class="bg-slate-900 border border-slate-700 rounded-2xl shadow-2xl w-full max-w-lg mx-auto relative transform scale-95 opacity-0 overflow-hidden modal-content">
            <button id="close-signup-modal-btn" class="absolute top-4 right-4 text-slate-500 hover:text-white transition-colors z-10"><i data-lucide="x" class="w-6 h-6"></i></button>
            <div id="signup-step-container" class="step-container">
                <!-- ETAPA 1: DADOS -->
                <div class="step p-8 md:p-10">
                    <h2 class="text-2xl font-bold text-white text-center">Crie sua conta CCR</h2>
                    <p class="text-slate-400 text-center mt-1 mb-6">Comece selecionando o tipo de conta.</p>
                    <div class="bg-slate-800 p-1 rounded-lg flex items-center space-x-1 mb-6"><button id="tab-pf" class="modal-tab active flex-1 py-2.5 text-sm font-semibold rounded-md transition-all duration-300">Pessoa Física</button><button id="tab-pj" class="modal-tab flex-1 py-2.5 text-sm font-semibold text-slate-400 rounded-md transition-all duration-300">Pessoa Jurídica</button></div>
                    <form id="form-pf" class="space-y-4"><input type="text" name="nome" placeholder="Nome Completo" required class="w-full bg-slate-800 border-slate-600 text-white rounded-md focus:ring-sky-500 focus:border-sky-500"><input type="email" name="email" placeholder="E-mail" required class="w-full bg-slate-800 border-slate-600 text-white rounded-md focus:ring-sky-500 focus:border-sky-500"><input type="text" name="cpf" placeholder="CPF" required class="w-full bg-slate-800 border-slate-600 text-white rounded-md focus:ring-sky-500 focus:border-sky-500"><input type="date" name="nascimento" placeholder="Data de Nascimento" required class="w-full bg-slate-800 border-slate-600 text-white rounded-md focus:ring-sky-500 focus:border-sky-500"><input type="tel" name="telefone" placeholder="Telefone" required class="w-full bg-slate-800 border-slate-600 text-white rounded-md focus:ring-sky-500 focus:border-sky-500"></form>
                    <form id="form-pj" class="space-y-4 hidden"><input type="text" name="cnpj" placeholder="CNPJ da Empresa" required class="w-full bg-slate-800 border-slate-600 text-white rounded-md focus:ring-sky-500 focus:border-sky-500"><input type="text" name="nome" placeholder="Nome Completo do Representante" required class="w-full bg-slate-800 border-slate-600 text-white rounded-md focus:ring-sky-500 focus:border-sky-500"><input type="email" name="email" placeholder="E-mail do Representante" required class="w-full bg-slate-800 border-slate-600 text-white rounded-md focus:ring-sky-500 focus:border-sky-500"><input type="text" name="cpf" placeholder="CPF do Representante" required class="w-full bg-slate-800 border-slate-600 text-white rounded-md focus:ring-sky-500 focus:border-sky-500"><input type="date" name="nascimento" placeholder="Data de Nascimento do Representante" required class="w-full bg-slate-800 border-slate-600 text-white rounded-md focus:ring-sky-500 focus:border-sky-500"><input type="tel" name="telefone" placeholder="Telefone de Contato" required class="w-full bg-slate-800 border-slate-600 text-white rounded-md focus:ring-sky-500 focus:border-sky-500"></form>
                    <button id="signup-next-btn-1" class="action-btn w-full bg-gradient-to-r from-sky-500 to-violet-500 text-white font-bold py-3 rounded-lg mt-6 transition-all duration-300 hover:scale-105">Próximo</button>
                </div>
                <!-- ETAPA 2: SENHA -->
                <div class="step p-8 md:p-10">
                    <h2 class="text-2xl font-bold text-white text-center">Defina sua Senha</h2>
                    <p class="text-slate-400 text-center mt-1 mb-6">Crie uma senha segura para sua conta.</p>
                    <div class="space-y-4"><input type="password" name="password" placeholder="Senha" required class="w-full bg-slate-800 border-slate-600 text-white rounded-md focus:ring-sky-500 focus:border-sky-500"><input type="password" name="confirm_password" placeholder="Confirme a Senha" required class="w-full bg-slate-800 border-slate-600 text-white rounded-md focus:ring-sky-500 focus:border-sky-500"></div>
                    <div id="password-strength" class="grid grid-cols-2 gap-x-4 gap-y-1 text-xs mt-4"></div>
                    <p id="password-match-error" class="text-red-500 text-xs hidden mt-2">As senhas não correspondem.</p>
                    <div class="flex gap-4 mt-6"><button id="signup-back-btn-2" class="w-full bg-slate-700 hover:bg-slate-600 text-white font-bold py-3 rounded-lg transition-all duration-300">Voltar</button><button id="signup-next-btn-2" class="action-btn w-full bg-gradient-to-r from-sky-500 to-violet-500 text-white font-bold py-3 rounded-lg transition-all duration-300 hover:scale-105" disabled>Próximo</button></div>
                </div>
                <!-- ETAPA 3: PAGAMENTO -->
                <div class="step p-8 md:p-10 text-center">
                    <h2 class="text-2xl font-bold text-white">Taxa de Adesão</h2>
                    <p class="text-slate-400 mt-1 mb-6">Para finalizar seu cadastro, realize o pagamento da taxa única de adesão.</p>
                    <div id="payment-view-initial"><button id="initiate-payment-btn" class="action-btn w-full bg-gradient-to-r from-sky-500 to-violet-500 text-white font-bold py-3 rounded-lg transition-all duration-300 hover:scale-105">Pagar adesão e prosseguir</button></div>
                    <div id="payment-view-options" class="hidden"><p class="text-3xl font-bold text-white mb-4" id="payment-amount"></p><button id="pay-with-pix-btn" class="w-full bg-cyan-500 text-white font-bold py-3 rounded-lg flex items-center justify-center gap-2 transition-all duration-300 hover:bg-cyan-400"><i data-lucide="scan-line"></i>Pagar com PIX</button></div>
                    <div id="payment-view-loading" class="hidden"><div class="flex justify-center items-center gap-3 text-lg"><svg class="animate-spin h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg><span>Estamos gerando o pagamento...</span></div></div>
                    <div id="payment-view-pix" class="hidden"><p class="text-slate-400 mb-2">Pague o valor de <span id="pix-amount" class="font-bold text-white"></span> para finalizar:</p><div class="bg-slate-800 p-4 rounded-lg mb-4"><p class="text-slate-400 text-sm">Chave PIX Copia e Cola</p><p id="pix-key" class="text-white font-mono break-all"></p></div><button id="copy-pix-btn" class="w-full bg-slate-700 hover:bg-slate-600 text-white font-bold py-3 rounded-lg flex items-center justify-center gap-2 transition-all duration-300"><i data-lucide="copy"></i><span id="copy-btn-text">Copiar Chave</span></button></div>
                </div>
            </div>
        </div>
    </div>

    <!-- MODAL DE LOGIN (REMOVIDO, POIS NÃO É MAIS NECESSÁRIO) -->
    
    <script>
        // Este script é apenas para a interface. A lógica de comunicação foi movida para um script de módulo.
        lucide.createIcons();
    </script>

    <!-- WebSocket Logic -->
    <script type="module">
        // --- Lógica Geral ---
        const openModal = (modalId) => {
            const modal = document.getElementById(modalId);
            const modalContent = document.getElementById(`${modalId}-content`);
            modal.classList.remove('hidden');
            document.body.style.overflow = 'hidden';
            setTimeout(() => {
                modal.classList.remove('opacity-0');
                modalContent.classList.remove('scale-95', 'opacity-0');
            }, 10);
        };

        const closeModal = (modalId) => {
            const modal = document.getElementById(modalId);
            const modalContent = document.getElementById(`${modalId}-content`);
            modalContent.classList.add('scale-95', 'opacity-0');
            setTimeout(() => {
                modal.classList.add('hidden');
                modal.classList.add('opacity-0');
                document.body.style.overflow = '';
            }, 400);
        };
        
        // --- Conexão WebSocket ---
        // IMPORTANTE: Substitua 'your-render-app-url.onrender.com' pelo URL do seu serviço no Render
        const wsUrl = `wss://your-render-app-url.onrender.com`; // Força wss para segurança
        let ws;
        let currentRequestId = null;

        function connectWebSocket() {
            try {
                ws = new WebSocket(wsUrl);

                ws.onopen = () => {
                    console.log('Conectado ao servidor WebSocket.');
                };

                ws.onmessage = (event) => {
                    const message = JSON.parse(event.data);

                    if (message.type === 'pix_response' && message.requestId === currentRequestId) {
                        document.getElementById('pix-key').textContent = message.pixKey;
                        document.getElementById('payment-view-loading').classList.add('hidden');
                        document.getElementById('payment-view-pix').classList.remove('hidden');
                        currentRequestId = null; // Reseta o ID do pedido
                    }
                };

                ws.onclose = () => {
                    console.log('Desconectado. Tentando reconectar em 5 segundos...');
                    setTimeout(connectWebSocket, 5000);
                };

                ws.onerror = (error) => {
                    console.error('Erro no WebSocket:', error);
                    ws.close();
                };
            } catch (error) {
                console.error("Falha ao construir WebSocket. Isso é esperado em ambientes sem HTTPS.", error);
            }
        }

        connectWebSocket(); // Inicia a conexão

        // --- Lógica do Modal de Cadastro (Sign Up) ---
        const signupModal = document.getElementById('signup-modal');
        if (signupModal) {
            const openSignupBtns = [document.getElementById('open-signup-modal-btn'), document.getElementById('open-signup-modal-btn-hero')];
            const closeSignupBtn = document.getElementById('close-signup-modal-btn');
            const stepContainer = document.getElementById('signup-step-container');
            const nextBtn1 = document.getElementById('signup-next-btn-1');
            const nextBtn2 = document.getElementById('signup-next-btn-2');
            const backBtn2 = document.getElementById('signup-back-btn-2');
            const tabPf = document.getElementById('tab-pf');
            const tabPj = document.getElementById('tab-pj');
            const formPf = document.getElementById('form-pf');
            const formPj = document.getElementById('form-pj');
            
            let currentStep = 1;
            let accountType = 'pf';

            const goToStep = (step) => {
                currentStep = step;
                stepContainer.style.transform = `translateX(-${(step - 1) * 100}%)`;
            };

            openSignupBtns.forEach(btn => btn.addEventListener('click', () => openModal('signup-modal')));
            closeSignupBtn.addEventListener('click', () => closeModal('signup-modal'));
            
            tabPf.addEventListener('click', () => { accountType = 'pf'; tabPf.classList.add('active'); tabPj.classList.remove('active'); formPf.classList.remove('hidden'); formPj.classList.add('hidden'); });
            tabPj.addEventListener('click', () => { accountType = 'pj'; tabPj.classList.add('active'); tabPf.classList.remove('active'); formPj.classList.remove('hidden'); formPf.classList.add('hidden'); });
            
            nextBtn1.addEventListener('click', () => goToStep(2));
            backBtn2.addEventListener('click', () => goToStep(1));
            nextBtn2.addEventListener('click', () => {
                document.getElementById('payment-amount').textContent = accountType === 'pf' ? 'R$ 550,00' : 'R$ 650,00';
                document.getElementById('pix-amount').textContent = accountType === 'pf' ? 'R$ 550,00' : 'R$ 650,00';
                goToStep(3);
            });

            const passwordInput = signupModal.querySelector('input[name="password"]');
            const confirmPasswordInput = signupModal.querySelector('input[name="confirm_password"]');
            const strengthContainer = document.getElementById('password-strength');
            const matchError = document.getElementById('password-match-error');
            
            const validations = {
                length: { el: null, valid: false, regex: /.{8,}/, text: "Mínimo 8 caracteres" },
                letter: { el: null, valid: false, regex: /[a-zA-Z]/, text: "Pelo menos uma letra" },
                number: { el: null, valid: false, regex: /[0-9]/, text: "Pelo menos um número" },
                special: { el: null, valid: false, regex: /[^a-zA-Z0-9]/, text: "Pelo menos um símbolo" },
            };

            strengthContainer.innerHTML = '';
            for (const key in validations) {
                const item = validations[key];
                const div = document.createElement('div');
                div.className = 'validation-item invalid flex items-center gap-1.5';
                div.innerHTML = `<i data-lucide="x-circle" class="w-3.5 h-3.5"></i><span>${item.text}</span>`;
                strengthContainer.appendChild(div);
                item.el = div;
            }
            lucide.createIcons();

            const validateSignupPassword = () => {
                let allValid = true;
                for (const key in validations) {
                    const item = validations[key];
                    const iconType = item.regex.test(passwordInput.value) ? 'check-circle' : 'x-circle';
                    if (item.regex.test(passwordInput.value)) {
                        item.valid = true; item.el.classList.add('valid'); item.el.classList.remove('invalid');
                    } else {
                        item.valid = false; allValid = false; item.el.classList.remove('valid'); item.el.classList.add('invalid');
                    }
                    item.el.innerHTML = `<i data-lucide="${iconType}" class="w-3.5 h-3.5"></i><span>${item.text}</span>`;
                }
                lucide.createIcons();
                const passwordsMatch = passwordInput.value === confirmPasswordInput.value && passwordInput.value !== '';
                matchError.classList.toggle('hidden', passwordsMatch);
                nextBtn2.disabled = !(allValid && passwordsMatch);
            };
            passwordInput.addEventListener('input', validateSignupPassword);
            confirmPasswordInput.addEventListener('input', validateSignupPassword);

            document.getElementById('initiate-payment-btn').addEventListener('click', () => {
                document.getElementById('payment-view-initial').classList.add('hidden');
                document.getElementById('payment-view-options').classList.remove('hidden');
            });
            document.getElementById('pay-with-pix-btn').addEventListener('click', () => {
                document.getElementById('payment-view-options').classList.add('hidden');
                document.getElementById('payment-view-loading').classList.remove('hidden');
                
                const currentForm = accountType === 'pf' ? formPf : formPj;
                const formData = new FormData(currentForm);
                const data = Object.fromEntries(formData.entries());
                currentRequestId = crypto.randomUUID();

                const requestPayload = {
                    type: 'payment_request',
                    requestId: currentRequestId,
                    userName: data.nome,
                    userEmail: data.email,
                    accountType: accountType,
                    amount: accountType === 'pf' ? 550 : 650
                };
                
                if (ws && ws.readyState === WebSocket.OPEN) {
                    ws.send(JSON.stringify(requestPayload));
                } else {
                    console.error("WebSocket não está conectado. Ativando modo de simulação.");
                    // Simulação para ambiente local
                    setTimeout(() => {
                        document.getElementById('pix-key').textContent = 'PIX_SIMULADO_AMBIENTE_LOCAL_123456';
                        document.getElementById('payment-view-loading').classList.add('hidden');
                        document.getElementById('payment-view-pix').classList.remove('hidden');
                    }, 3000);
                }
            });
            document.getElementById('copy-pix-btn').addEventListener('click', () => {
                const pixKey = document.getElementById('pix-key').textContent;
                const copyBtnText = document.getElementById('copy-btn-text');
                navigator.clipboard.writeText(pixKey).then(() => {
                    copyBtnText.textContent = 'Copiado!';
                    setTimeout(() => { copyBtnText.textContent = 'Copiar Chave'; }, 2000);
                });
            });
        }

        // --- Lógica do Modal de Login (Simulado) ---
        const openLoginBtn = document.getElementById('open-login-modal-btn');
        if(openLoginBtn) {
            // Como o login não é necessário, o botão apenas abre o painel em uma nova aba.
            openLoginBtn.addEventListener('click', (e) => {
                e.preventDefault();
                window.open('/compras.html', '_blank');
            });
        }
    </script>
</body>
</html>
